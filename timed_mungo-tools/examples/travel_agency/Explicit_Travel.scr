module travel_agency.Explicit_Travel;

type <java> "java.lang.Integer" from "rt.jar" as Int;
type <java> "java.lang.String" from "rt.jar" as String;

explicit global protocol BookingExp(role C, role A, role S)
{
	Query(String) connect C to A;
		choice at C
    	{
    		Query(String) from C to A;
    		Quote(Int) from A to C;
    		//continue X;
    		//wrap A to C;
    	}
    	or
    	{
    		choice at C
    		{
    			Yes() from C to A;
    			connect A to S;
    			Yes() from A to S;
    			//disconnect A and S;  // Disconnects not needed in non-recursive flows

    			connect S to C;  // Needs session id to correlate connections -- ideally fresh "shared channels"
    			Payment(String) from C to S;
    			Ack() from S to C;

    			disconnect S and C;
    		}
    		or
    		{
    			No() from C to A;
    		}
    		Bye() from C to A;
    	}
}

aux global protocol BookingExpAux(role C, role A, role S)
{
	choice at C
	{
		Query(String) from C to A;
		Quote(Int) from A to C;
		//continue X;
		//wrap A to C;
		do BookingExpAux(C, A, S);
	}
	or
	{
		choice at C
		{
			Yes() from C to A;
			connect A to S;
			Yes() from A to S;
			//disconnect A and S;  // Disconnects not needed in non-recursive flows

			connect S to C;  // Needs session id to correlate connections -- ideally fresh "shared channels"
			Payment(String) from C to S;
			Ack() from S to C;

			disconnect S and C;
		}
		or
		{
			No() from C to A;
		}
		Bye() from C to A;
	}
}